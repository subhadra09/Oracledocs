Check size of UNDO Table:

SELECT d.tablespace_name, round(((NVL(f.bytes,0) + (a.maxbytes - a.bytes))/1048576+ u.exp_space),2)
  as max_free_mb, round(((a.bytes - (NVL(f.bytes,0)+ (1024*1024*u.exp_space)))*100/a.maxbytes),2)
  used_pct FROM sys.dba_tablespaces d, (select tablespace_name, sum(bytes) bytes,
  sum(greatest(maxbytes,bytes)) maxbytes from sys.dba_data_files group by tablespace_name) a,
  (select tablespace_name, sum(bytes) bytes from sys.dba_free_space group by tablespace_name) f ,
  (select tablespace_name , sum(blocks)*8/(1024) exp_space from
  dba_undo_extents where status NOT IN ('ACTIVE','UNEXPIRED') group by tablespace_name) u
  WHERE d.tablespace_name = a.tablespace_name(+) AND d.tablespace_name = f.tablespace_name(+)
  AND d.tablespace_name=u.tablespace_name AND d.contents = 'UNDO' AND u.tablespace_name = (select UPPER(value)
  from v$parameter where name = 'undo_tablespace');

Check size of Undo Active/Expired/Unexpired:

select     tablespace_name,   
status,
count(extent_id) "Extent Count",
sum(blocks) "Total Blocks",         
sum(blocks)*8/(1024*1024) total_space
from     dba_undo_extents
group by    tablespace_name, status;


To see UNDO Retention:
SELECT tablespace_name, retention FROM dba_tablespaces where tablespace_name like '%UNDO%';

To see sessions which are consuming more undo usage:
SELECT  a.sid, a.username, b.used_urec, b.used_ublk
FROM v$session a, v$transaction b
WHERE a.saddr = b.ses_addr
ORDER BY b.used_ublk DESC;

select a.sid, a.serial#, a.username, b.used_urec used_undo_record, b.used_ublk used_undo_blocks
from v$session a, v$transaction b
where a.saddr=b.ses_addr ;


 5. Post upgrade steps 


We see that there is enough space in Undo Table space, while currently the space is consumed by expired and unexpired which can be occupied by active sessions anytime if required. Since the table space retention is in no guarantee.


